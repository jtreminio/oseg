{%- macro print_scalar(printable) -%}
{% if printable.value == "null" %}undefined{% else %}
{{ printable.value }}
{%- endif %}
{%- endmacro -%}

{%- macro print_scalar_array(printable) -%}
    {% if printable.value == None %}undefined{% else %}
[
        {% for i in printable.value %}
    {{ i }},
        {% endfor %}
]{% if printable.is_enum and not printable.target_type %} as Array<{{ printable.value|join(" | ")}}>{% endif %}
    {%- endif %}
{%- endmacro -%}

{%- macro print_file(printable) -%}
    {% if printable.value == None %}undefined{% else %}
fs.createReadStream("{{ printable.value }}")
    {%- endif %}
{%- endmacro -%}

{%- macro print_file_array(printable) -%}
    {% if printable.value == None %}undefined{% else %}
[
        {% for i in printable.value %}
    fs.createReadStream("{{ i }}"),
        {% endfor %}
]
    {%- endif %}
{%- endmacro -%}

{%- macro print_free_form(printable) -%}
    {% if printable.value == None %}undefined{% else %}
{
        {% for k, v in printable.value.items() %}
    "{{ k }}": {{ v }},
        {% endfor %}
}
    {%- endif %}
{%- endmacro -%}

{%- macro print_free_form_array(printable) -%}
    {% if printable.value == None %}undefined{% else %}
[
        {% for obj in printable.value %}
    {
            {% for k, v in obj.items() %}
        "{{ k }}": {{ v }},
            {% endfor %}
    },
        {% endfor %}
]
    {%- endif %}
{%- endmacro -%}

{%- macro print_object(printable) -%}
    {% if printable.value == None %}undefined{% else %}
{{ printable.value }}
    {%- endif %}
{%- endmacro -%}

{%- macro print_object_array(printable) -%}
    {% if printable.value == None %}undefined{% else %}
[
    {% for i in printable.value %}
    {{ i|camel_case }},
    {% endfor %}
]
    {%- endif %}
{%- endmacro -%}

{%- import "_macros.jinja2" as m with context -%}

import * as fs from 'fs';
import api from "{{ sdk_options.additional_properties.npmName }}"
import models from "{{ sdk_options.additional_properties.npmName }}"

const apiCaller = new api.{{ operation.api_name|pascal_case }}Api();

{% for obj_name, obj in property_container.flattened_objects().items() %}
    {% set parent_name = obj_name if obj_name != property_container.body.type else "" %}
    {% if not obj.is_array %}
const {{ obj_name|print_variable }} = new models.{{ obj.type }}();
    {% call(properties) m.parse_object_properties_macro(obj, 0) %}
        {% for name, value in properties.items() %}
{{ obj_name|print_variable }}.{{ name|print_setter }} = {{ value }};
        {% endfor %}
    {% endcall %}
    {% else %}
const {{ obj_name|print_variable }} = {{ "" }}
        {%- call(value) m.parse_object_list_properties_macro(obj, 0) %}
    {{- value }};
        {% endcall %}
    {% endif %}

{% endfor %}
{% if operation.request.parameters or operation.request.has_formdata %}
    {% call(properties) m.parse_api_call_properties_macro(property_container, 0, null, False) %}
        {% for name, value in properties.items() %}
const {{ name|print_variable }} = {{ value }};
        {% endfor %}
    {% endcall %}

{% endif %}
apiCaller.{{ operation.operation_id|camel_case }}({% if not property_container.has_data %})
{%- else %}

{% call(properties) m.parse_api_call_properties_macro(property_container, 4) %}
    {% for name, value in properties.items() %}
    {{ name|print_variable }},
    {% endfor %}
{% endcall %}
){% endif %}{%- if operation.response and operation.response.body  %}.then(response => {
{% if not operation.response.is_binary %}
  console.log(response.body);
{% elif operation.response.is_binary %}
  fs.createWriteStream('file_response.zip').write(response.body);
{% endif -%}
}){% endif %}.catch(error => {
  console.log("Exception when calling {{ operation.api_name|pascal_case }}#{{ operation.operation_id|camel_case }}:");
  console.log(error.body);
});
{{ "" }}
