#!/usr/bin/env bash

## example: ./bin/package-python petstore

set -e

DIR=$(cd `dirname $0` && pwd)
PROJECT=$1
SDK="python"
WORKING_DIR="/app/openapi"
PROJECT_DIR="${DIR}/../examples/${PROJECT}"
SDK_DIR="${PROJECT_DIR}/sdks/${SDK}"
TARGET_DIR="${PROJECT_DIR}/generated/${SDK}"
ARTIFACTS_DIR="${PROJECT_DIR}/generated/${SDK}/artifacts"
BASE_DIR="${DIR}/.."

if [[ -z "${PROJECT-}" ]] || [[ ! -d "${PROJECT_DIR}" ]]; then
  echo "Must provide project"
  exit 1
fi

rm -rf "${ARTIFACTS_DIR}"
mkdir -p "${ARTIFACTS_DIR}"

if [[ -f "${BASE_DIR}/venv/bin/python" ]]; then
  PYTHON="${BASE_DIR}/venv/bin/python"
else
  PYTHON="python3"
fi

pushd "${SDK_DIR}"
${PYTHON} -m build --wheel
cp dist/*-*.whl "${ARTIFACTS_DIR}/packaged.whl"
popd
